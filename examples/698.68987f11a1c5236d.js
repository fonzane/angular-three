"use strict";(self.webpackChunksandbox=self.webpackChunksandbox||[]).push([[698],{2396:(Nt,et,i)=>{i.d(et,{UC:()=>P.U,bS:()=>nt.b}),i(7540);var nt=i(693),P=i(1208)},1208:(Nt,et,i)=>{i.d(et,{U:()=>I,e:()=>nt});var l=i(7540),st=i(2046),R=i(3193);const U=["*"];let nt=(()=>{class p extends l.Jy{set args(S){this.set({instanceArgs:S})}set near(S){this.set({near:(0,l.su)(S)})}set far(S){this.set({far:(0,l.su)(S)})}set renderTarget(S){this.set({renderTarget:S})}objectInitFn(){const S=this.get(m=>m.instanceArgs);return new st._am(...S)}get preObjectInit(){return S=>{const m=this.get(d=>d.instanceArgs);m&&m.length&&this.set({near:m[0],far:m[1],renderTarget:m[2]}),this.effect((0,l.oe)(()=>{S()}))(this.instanceArgs$)}}get optionFields(){return Object.assign(Object.assign({},super.optionFields),{near:!1,far:!1,renderTarget:!1})}}return p.\u0275fac=function(){let O;return function(m){return(O||(O=R.n5z(p)))(m||p)}}(),p.\u0275cmp=R.Xpm({type:p,selectors:[["ngt-cube-camera"]],inputs:{args:"args",near:"near",far:"far",renderTarget:"renderTarget"},features:[R._Bn([(0,l.Q2)(p)]),R.qOj],ngContentSelectors:U,decls:1,vars:0,template:function(S,m){1&S&&(R.F$t(),R.Hsn(0))},encapsulation:2,changeDetection:0}),p})(),I=(()=>{class p{}return p.\u0275fac=function(S){return new(S||p)},p.\u0275mod=R.oAB({type:p}),p.\u0275inj=R.cJS({}),p})()},693:(Nt,et,i)=>{i.d(et,{b:()=>I,p:()=>nt});var l=i(7540),st=i(2046),R=i(3193);const U=["*"];let nt=(()=>{class p extends l.fc{set left(S){this.set({left:(0,l.su)(S)})}set right(S){this.set({right:(0,l.su)(S)})}set top(S){this.set({top:(0,l.su)(S)})}set bottom(S){this.set({bottom:(0,l.su)(S)})}set near(S){this.set({near:(0,l.su)(S)})}set far(S){this.set({far:(0,l.su)(S)})}get cameraType(){return st.iKG}get optionFields(){return Object.assign(Object.assign({},super.optionFields),{left:!0,right:!0,top:!0,bottom:!0,near:!0,far:!0})}}return p.\u0275fac=function(){let O;return function(m){return(O||(O=R.n5z(p)))(m||p)}}(),p.\u0275cmp=R.Xpm({type:p,selectors:[["ngt-orthographic-camera"]],inputs:{left:"left",right:"right",top:"top",bottom:"bottom",near:"near",far:"far"},features:[R._Bn([(0,l.dF)(p)]),R.qOj],ngContentSelectors:U,decls:1,vars:0,template:function(S,m){1&S&&(R.F$t(),R.Hsn(0))},encapsulation:2,changeDetection:0}),p})(),I=(()=>{class p{}return p.\u0275fac=function(S){return new(S||p)},p.\u0275mod=R.oAB({type:p}),p.\u0275inj=R.cJS({}),p})()},6698:(Nt,et,i)=>{i.d(et,{hJ:()=>k.h,wj:()=>$.wj,vc:()=>Z.vc,YS:()=>It.YS}),i(7540),i(4761),i(2089),i(991),i(4552),i(9049),i(8919),i(6484);var $=i(1785);i(4994),i(7322);var A=i(2046);i(8255),i(2164),i(3444),new A.Pa4;var It=i(1658);i(221),i(5069),i(1615);var k=i(8736),Z=i(7426)},8736:(Nt,et,i)=>{i.d(et,{g:()=>ct,h:()=>bt});var l=i(7540),st=i(2396),R=i(2089),U=i(8255),nt=i(991),I=i(4476),p=i(2310),O=i(2046);const S={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "},m={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n\n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "};var d=i(3193),P=i(4552),Q=i(9049),z=i(8919),N=i(3617),L=i(693),o=i(9461);const W=function(w){return[1,w,1]},tt=function(w){return[w,0,0]},n=function(w,ot,s,T,j){return[w,ot,s,T,0,j]};function mt(w,ot){if(1&w&&(d.ynx(0),d.TgZ(1,"ngt-mesh",2),d.ALo(2,"radian"),d._UZ(3,"ngt-mesh-basic-material",3),d.qZA(),d._UZ(4,"ngt-orthographic-camera",4),d.BQk()),2&w){const s=ot.ngIf,T=d.oxw();d.xp6(1),d.Q6J("geometry",s.planeGeometry)("scale",d.VKq(10,W,-1))("rotation",d.VKq(12,tt,d.lcZ(2,8,-90))),d.xp6(2),d.Q6J("map",s.renderTarget.texture)("opacity",s.opacity)("depthWrite",s.depthWrite),d.xp6(1),d.Q6J("ref",T.shadowCameraRef)("args",d.qbA(14,n,-s.width/2,s.width/2,s.height/2,-s.height/2,s.far))}}let ct=(()=>{class w extends l.Fq{constructor(){super(...arguments),this.count=1,this.shadowViewModel$=this.select(this.select(s=>s.priority),this.select(s=>s.planeGeometry),this.select(s=>s.renderTarget),this.select(s=>s.opacity),this.select(s=>s.depthWrite),this.select(s=>s.scaledWidth),this.select(s=>s.scaledHeight),this.select(s=>s.far),(s,T,j,$,at,X,rt,J)=>({priority:s,planeGeometry:T,renderTarget:j,opacity:$,depthWrite:at,width:X,height:rt,far:J})),this.setShadows=this.effect((0,p.b)(()=>{const{resolution:s,scaledWidth:T,scaledHeight:j,color:$}=this.get(),at=this.store.get(A=>A.gl),X=new O.dd2(s,s);X.texture.encoding=at.outputEncoding;const rt=new O.dd2(s,s);rt.texture.generateMipmaps=X.texture.generateMipmaps=!1;const J=new O.BKK(T,j).rotateX(Math.PI/2),b=new O.Kj0(J),E=new O.lRF;E.depthTest=E.depthWrite=!1,E.onBeforeCompile=A=>{A.uniforms=Object.assign(Object.assign({},A.uniforms),{ucolor:{value:new O.Ilk($).convertSRGBToLinear()}}),A.fragmentShader=A.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n           void main() {\n          "),A.fragmentShader=A.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor, ( 1.0 - fragCoordZ ) * 1.0 );")};const g=new O.jyz(S),x=new O.jyz(m);x.depthTest=g.depthTest=!1,this.zone.run(()=>{this.set({renderTarget:X,planeGeometry:J,depthMaterial:E,blurPlane:b,horizontalBlurMaterial:g,verticalBlurMaterial:x,renderTargetBlur:rt})})}))}set opacity(s){this.set({opacity:(0,l.su)(s)})}set width(s){this.set({width:(0,l.su)(s)})}set height(s){this.set({height:(0,l.su)(s)})}set blur(s){this.set({blur:(0,l.su)(s)})}set far(s){this.set({far:(0,l.su)(s)})}set smooth(s){this.set({smooth:(0,l.Ig)(s)})}set resolution(s){this.set({resolution:(0,l.su)(s)})}set frames(s){this.set({frames:(0,l.su)(s)})}set depthWrite(s){this.set({depthWrite:(0,l.Ig)(s)})}get planeGeometry(){return this.get(s=>s.planeGeometry)}get renderTarget(){return this.get(s=>s.renderTarget)}get opacity(){return this.get(s=>s.opacity)}get depthWrite(){return this.get(s=>s.depthWrite)}get width(){return this.get(s=>s.scaledWidth)}get height(){return this.get(s=>s.scaledHeight)}get far(){return this.get(s=>s.far)}get shadowCameraRef(){return this.get(s=>s.shadowCameraRef)}preInit(){super.preInit(),this.set(s=>{var T,j,$,at,X,rt,J,b,E;return{shadowCameraRef:new l.Rl,scale:l.is.equ(s.scale.toArray(),(0,l.Ut)(1).toArray())?(0,l.Ut)(10):s.scale,frames:null!==(T=s.frames)&&void 0!==T?T:1/0,opacity:null!==(j=s.opacity)&&void 0!==j?j:1,width:null!==($=s.width)&&void 0!==$?$:1,height:null!==(at=s.height)&&void 0!==at?at:1,blur:null!==(X=s.blur)&&void 0!==X?X:1,far:null!==(rt=s.far)&&void 0!==rt?rt:10,resolution:null!==(J=s.resolution)&&void 0!==J?J:512,smooth:null===(b=s.smooth)||void 0===b||b,color:l.is.equ(s.color.toArray(),(0,l.EH)().toArray())?(0,l.EH)("#000000"):s.color,depthWrite:null!==(E=s.depthWrite)&&void 0!==E&&E}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.set(this.select(this.select(s=>s.width),this.select(s=>s.height),this.select(s=>s.scale),(s,T,j)=>({scaledWidth:s*j.x,scaledHeight:T*j.y}))),this.setShadows(this.select(this.select(s=>s.resolution),this.select(s=>s.scaledWidth),this.select(s=>s.scaledHeight),this.select(s=>s.scale),this.select(s=>s.color)))})})}onBeforeRender(s){s.scale.setScalar(1);const{shadowCameraRef:T,frames:j,depthMaterial:$,renderTarget:at,smooth:X,blur:rt}=this.get(),J=this.store.get(E=>E.gl),b=this.store.get(E=>E.scene);if(T.value&&at&&(j===1/0||this.count<j)){const E=b.background;b.background=null;const g=b.overrideMaterial;b.overrideMaterial=$,J.setRenderTarget(at),J.render(b,T.value),b.overrideMaterial=g,this.blurShadows(rt),X&&this.blurShadows(.4*rt),J.setRenderTarget(null),b.background=E,this.count++}}blurShadows(s){const{renderTarget:T,blurPlane:j,horizontalBlurMaterial:$,verticalBlurMaterial:at,renderTargetBlur:X,shadowCameraRef:rt}=this.get(),J=this.store.get(b=>b.gl);j.visible=!0,j.material=$,$.uniforms.tDiffuse.value=T.texture,$.uniforms.h.value=s/256,J.setRenderTarget(X),J.render(j,rt.value),j.material=at,at.uniforms.tDiffuse.value=X.texture,at.uniforms.v.value=s/256,J.setRenderTarget(T),J.render(j,rt.value),j.visible=!1}}return w.\u0275fac=function(){let ot;return function(T){return(ot||(ot=d.n5z(w)))(T||w)}}(),w.\u0275cmp=d.Xpm({type:w,selectors:[["ngt-soba-contact-shadows"]],inputs:{opacity:"opacity",width:"width",height:"height",blur:"blur",far:"far",smooth:"smooth",resolution:"resolution",frames:"frames",depthWrite:"depthWrite"},features:[d._Bn([(0,l.Hm)(w)]),d.qOj],decls:4,vars:10,consts:[["name","soba-contact-shadows",3,"ngtObjectInputs","ngtObjectOutputs","rotation","beforeRender"],[4,"ngIf"],[3,"geometry","scale","rotation"],["transparent","",3,"map","opacity","depthWrite"],[3,"ref","args"]],template:function(s,T){1&s&&(d.TgZ(0,"ngt-group",0),d.NdJ("beforeRender",function($){return T.onBeforeRender($.object)}),d.ALo(1,"radian"),d.YNc(2,mt,5,20,"ng-container",1),d.ALo(3,"async"),d.qZA()),2&s&&(d.Q6J("ngtObjectInputs",T)("ngtObjectOutputs",T)("rotation",d.VKq(8,tt,d.lcZ(1,4,90))),d.xp6(2),d.Q6J("ngIf",d.lcZ(3,6,T.shadowViewModel$)))},directives:[P.U,Q.V,I.O5,z.o,N.$,L.p],pipes:[o.j,I.Ov],encapsulation:2,changeDetection:0}),w})(),bt=(()=>{class w{}return w.\u0275fac=function(s){return new(s||w)},w.\u0275mod=d.oAB({type:w}),w.\u0275inj=d.cJS({imports:[[R.I,l.y2,l.kZ,nt.M$,U.g4,st.bS,I.ez]]}),w})()},1785:(Nt,et,i)=>{i.d(et,{$5:()=>Ut,wj:()=>Ht});var l=i(7540),st=i(2396),R=i(4761),U=i(8255),nt=i(991),I=i(4476),p=i(5255),O=i(6422),S=i(758),m=i(6153),d=i(6517),P=i(2310),Q=i(4643),z=i(6822),N=i(7727),L=i(6083),o=i(2046);class W extends o.yxD{constructor(f){super(f),this.type=o.cLu}parse(f){const v=function(M,G){switch(M){case 1:console.error("THREE.RGBELoader Read Error: "+(G||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(G||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(G||""));break;default:console.error("THREE.RGBELoader: Error: "+(G||""))}return-1},pt=function(M,G,V){G=G||1024;let Z=M.pos,u=-1,r=0,e="",h=String.fromCharCode.apply(null,new Uint16Array(M.subarray(Z,Z+128)));for(;0>(u=h.indexOf("\n"))&&r<G&&Z<M.byteLength;)e+=h,r+=h.length,Z+=128,h+=String.fromCharCode.apply(null,new Uint16Array(M.subarray(Z,Z+128)));return-1<u&&(!1!==V&&(M.pos+=r+u+1),e+h.slice(0,u))},Ot=function(M,G,V,k){const u=Math.pow(2,M[G+3]-128)/255;V[k+0]=M[G+0]*u,V[k+1]=M[G+1]*u,V[k+2]=M[G+2]*u,V[k+3]=1},Et=function(M,G,V,k){const u=Math.pow(2,M[G+3]-128)/255;V[k+0]=o.A5E.toHalfFloat(Math.min(M[G+0]*u,65504)),V[k+1]=o.A5E.toHalfFloat(Math.min(M[G+1]*u,65504)),V[k+2]=o.A5E.toHalfFloat(Math.min(M[G+2]*u,65504)),V[k+3]=o.A5E.toHalfFloat(1)},Rt=new Uint8Array(f);Rt.pos=0;const _t=function(M){const V=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,k=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*FORMAT=(\S+)\s*$/,u=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,r={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let e,h;if(M.pos>=M.byteLength||!(e=pt(M)))return v(1,"no header found");if(!(h=e.match(/^#\?(\S+)/)))return v(3,"bad initial token");for(r.valid|=1,r.programtype=h[1],r.string+=e+"\n";e=pt(M),!1!==e;)if(r.string+=e+"\n","#"!==e.charAt(0)){if((h=e.match(V))&&(r.gamma=parseFloat(h[1])),(h=e.match(k))&&(r.exposure=parseFloat(h[1])),(h=e.match(Z))&&(r.valid|=2,r.format=h[1]),(h=e.match(u))&&(r.valid|=4,r.height=parseInt(h[1],10),r.width=parseInt(h[2],10)),2&r.valid&&4&r.valid)break}else r.comments+=e+"\n";return 2&r.valid?4&r.valid?r:v(3,"missing image size specifier"):v(3,"missing format specifier")}(Rt);if(-1!==_t){const M=_t.width,G=_t.height,V=function(M,G,V){const k=G;if(k<8||k>32767||2!==M[0]||2!==M[1]||128&M[2])return new Uint8Array(M);if(k!==(M[2]<<8|M[3]))return v(3,"wrong scanline width");const Z=new Uint8Array(4*G*V);if(!Z.length)return v(4,"unable to allocate buffer space");let u=0,r=0;const e=4*k,h=new Uint8Array(4),C=new Uint8Array(e);let D=V;for(;D>0&&r<M.byteLength;){if(r+4>M.byteLength)return v(1);if(h[0]=M[r++],h[1]=M[r++],h[2]=M[r++],h[3]=M[r++],2!=h[0]||2!=h[1]||(h[2]<<8|h[3])!=k)return v(3,"bad rgbe scanline format");let Y,H=0;for(;H<e&&r<M.byteLength;){Y=M[r++];const lt=Y>128;if(lt&&(Y-=128),0===Y||H+Y>e)return v(3,"bad scanline data");if(lt){const it=M[r++];for(let Ct=0;Ct<Y;Ct++)C[H++]=it}else C.set(M.subarray(r,r+Y),H),H+=Y,r+=Y}const gt=k;for(let lt=0;lt<gt;lt++){let it=0;Z[u]=C[lt+it],it+=k,Z[u+1]=C[lt+it],it+=k,Z[u+2]=C[lt+it],it+=k,Z[u+3]=C[lt+it],u+=4}D--}return Z}(Rt.subarray(Rt.pos),M,G);if(-1!==V){let k,Z,u,r;switch(this.type){case o.VzW:r=V.length/4;const e=new Float32Array(4*r);for(let C=0;C<r;C++)Ot(V,4*C,e,4*C);k=e,u=o.VzW;break;case o.cLu:r=V.length/4;const h=new Uint16Array(4*r);for(let C=0;C<r;C++)Et(V,4*C,h,4*C);k=h,u=o.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:M,height:G,data:k,header:_t.string,gamma:_t.gamma,exposure:_t.exposure,format:Z,type:u}}}return null}setDataType(f){return this.type=f,this}load(f,t,a,y){return super.load(f,function F(_,v){switch(_.type){case o.VzW:case o.cLu:_.encoding=o.rnI,_.minFilter=o.wem,_.magFilter=o.wem,_.generateMipmaps=!1,_.flipY=!0}t&&t(_,v)},a,y)}}var tt=i(4994),n=i(3193),mt=i(2375),ct=i(1208),bt=i(8919),w=i(4001),ot=i(7669),s=i(2455);const T=["map",""],j=["*"];function $(c,f){1&c&&n.GkF(0)}const at=function(c,f,t){return[c,f,t]};function X(c,f){if(1&c){const t=n.EpF();n.TgZ(0,"ngt-cube-camera",5),n.NdJ("beforeRender",function(){return n.CHM(t),n.oxw().onBeforeRender()}),n.qZA()}if(2&c){const t=f.ngIf,a=n.oxw();n.Q6J("ref",a.cubeCamera)("args",n.kEZ(2,at,a.near,a.far,t))}}function rt(c,f){if(1&c&&n._UZ(0,"ngt-soba-environment-cube",6),2&c){const t=n.oxw();n.Q6J("ngtSobaEnvironmentPassThrough",t)}}function J(c,f){if(1&c&&n._UZ(0,"ngt-soba-environment-map",7),2&c){const t=n.oxw();n.Q6J("ngtSobaEnvironmentPassThrough",t)("map",t.map)}}const b=function(){return[1,16]};function E(c,f){if(1&c&&(n.ynx(0),n._UZ(1,"ngt-soba-environment-map",1),n.TgZ(2,"ngt-mesh",2),n._UZ(3,"ngt-icosahedron-geometry",3)(4,"ngt-shader-material",4),n.ALo(5,"side"),n.qZA(),n.BQk()),2&c){const t=f.ngIf,a=n.oxw();n.xp6(1),n.Q6J("ngtSobaEnvironmentPassThrough",a)("map",t.texture),n.xp6(1),n.Q6J("scale",t.scale),n.xp6(1),n.Q6J("args",n.DdM(11,b)),n.xp6(1),n.Q6J("ref",a.materialRef)("side",n.lcZ(5,9,"back"))("vertexShader",a.vertexShader)("fragmentShader",t.fragment)("uniforms",a.uniforms)}}function g(c,f){if(1&c&&n._UZ(0,"ngt-soba-environment-ground",2),2&c){const t=n.oxw();n.Q6J("ngtSobaEnvironmentPassThrough",t)}}function x(c,f){if(1&c&&n._UZ(0,"ngt-soba-environment-map",5),2&c){const t=n.oxw(2);n.Q6J("ngtSobaEnvironmentPassThrough",t)("map",t.map)}}function A(c,f){1&c&&n.GkF(0)}function K(c,f){if(1&c&&n.YNc(0,A,1,0,"ng-container",8),2&c){const t=n.oxw(4);n.Q6J("ngTemplateOutlet",t.content.templateRef)}}function ut(c,f){if(1&c&&(n.TgZ(0,"ngt-soba-environment-portal",2),n.YNc(1,K,1,1,"ng-template",7),n.qZA()),2&c){const t=n.oxw(3);n.Q6J("ngtSobaEnvironmentPassThrough",t)}}function ht(c,f){if(1&c&&n._UZ(0,"ngt-soba-environment-cube",2),2&c){const t=n.oxw(3);n.Q6J("ngtSobaEnvironmentPassThrough",t)}}function vt(c,f){if(1&c&&(n.YNc(0,ut,2,1,"ngt-soba-environment-portal",0),n.YNc(1,ht,1,1,"ng-template",null,6,n.W1O)),2&c){const t=n.MAs(2),a=n.oxw(2);n.Q6J("ngIf",!!a.content)("ngIfElse",t)}}function Mt(c,f){if(1&c&&(n.YNc(0,x,1,2,"ngt-soba-environment-map",3),n.YNc(1,vt,3,2,"ng-template",null,4,n.W1O)),2&c){const t=n.MAs(2),a=n.oxw();n.Q6J("ngIf",!!a.map)("ngIfElse",t)}}const Gt=c=>!!c&&c.isCubeTexture;function Pt(c){return l.is.ref(c)?c.value:c}let dt=(()=>{class c extends l.WZ{get frames(){return this.get(t=>t.frames)}set frames(t){this.set({frames:(0,l.su)(t)})}get near(){return this.get(t=>t.near)}set near(t){this.set({near:(0,l.su)(t)})}get far(){return this.get(t=>t.far)}set far(t){this.set({far:(0,l.su)(t)})}get resolution(){return this.get(t=>t.resolution)}set resolution(t){this.set({resolution:(0,l.su)(t)})}get background(){return this.get(t=>t.background)}set background(t){this.set({background:"only"===t?t:(0,l.Ig)(t)})}get map(){return this.get(t=>t.map)}set map(t){this.set({map:t})}get files(){return this.get(t=>t.files)}set files(t){this.set({files:t})}get path(){return this.get(t=>t.path)}set path(t){this.set({path:t})}get preset(){return this.get(t=>t.preset)}set preset(t){this.set({preset:t})}get scene(){return this.get(t=>t.scene)}set scene(t){this.set({scene:t})}get extensions(){return this.get(t=>t.extensions)}set extensions(t){this.set({extensions:t})}get ground(){return this.get(t=>t.ground)}set ground(t){this.set({ground:l.is.obj(t)?t:(0,l.Ig)(t)})}}return c.\u0275fac=function(){let f;return function(a){return(f||(f=n.n5z(c)))(a||c)}}(),c.\u0275dir=n.lG2({type:c,inputs:{frames:"frames",near:"near",far:"far",resolution:"resolution",background:"background",map:"map",files:"files",path:"path",preset:"preset",scene:"scene",extensions:"extensions",ground:"ground"},features:[n.qOj]}),c})(),Tt=(()=>{class c{constructor(t){this.host=t}set ngtSobaEnvironmentPassThrough(t){this.assertWrapper(t),t.select(t.select(a=>a.frames).pipe((0,l.Xb)()),t.select(a=>a.near).pipe((0,l.Xb)()),t.select(a=>a.far).pipe((0,l.Xb)()),t.select(a=>a.resolution).pipe((0,l.Xb)()),t.select(a=>a.background).pipe((0,l.Xb)()),t.select(a=>a.map).pipe((0,l.Xb)()),t.select(a=>a.files).pipe((0,l.Xb)()),t.select(a=>a.path).pipe((0,l.Xb)()),t.select(a=>a.preset).pipe((0,l.Xb)()),t.select(a=>a.scene).pipe((0,l.Xb)()),t.select(a=>a.extensions).pipe((0,l.Xb)()),t.select(a=>a.ground).pipe((0,l.Xb)())).pipe((0,p.R)(t.destroy$)).subscribe(()=>{this.host.frames=t.frames,this.host.near=t.near,this.host.far=t.far,this.host.resolution=t.resolution,this.host.background=t.background,this.host.map=t.map,this.host.files=t.files,this.host.path=t.path,this.host.preset=t.preset,this.host.scene=t.scene,this.host.extensions=t.extensions,this.host.ground=t.ground})}assertWrapper(t){if(!(t instanceof dt))throw new Error("[ngtSobaEnvironmentPassThrough] wrapper is not an NgtSobaEnvironmentGeneric")}}return c.\u0275fac=function(t){return new(t||c)(n.Y36(dt,10))},c.\u0275dir=n.lG2({type:c,selectors:[["","ngtSobaEnvironmentPassThrough",""]],inputs:{ngtSobaEnvironmentPassThrough:"ngtSobaEnvironmentPassThrough"}}),c})(),Ft=(()=>{class c extends l.gU{constructor(t,a){super(),this.loader=t,this.store=a,this.setTexture=this.effect((0,l.oe)(()=>{const{textureRef:y,extensions:F,preset:_}=this.get();let{files:v,path:B}=this.get();if(_){if(!(_ in tt.n))throw new Error("Preset must be one of: "+Object.keys(tt.n).join(", "));v=tt.n[_],B="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const q=Array.isArray(v),ft=this.loader.use(q?o.cBK:W,q?[v]:v,pt=>{pt.setPath(B),F&&F(pt)}).subscribe(pt=>{const St=q?pt[0]:pt;St.mapping=q?o.fY$:o.dSO,y.set(St)});return()=>{ft.unsubscribe()}})),this.set({textureRef:new l.Rl})}use(t){this.useSubscription&&this.useSubscription.unsubscribe();const a=t({files:["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:""}),y=(0,O.b)(a)?a:(0,S.of)(a);return this.set(y),this.useSubscription=this.onCanvasReady(this.store.ready$,()=>(this.setTexture(this.select(this.select(F=>F.path),this.select(F=>F.files),this.select(F=>F.preset).pipe((0,l.Xb)()),this.select(F=>F.extensions).pipe((0,l.Xb)()))),()=>{this.useSubscription&&this.useSubscription.unsubscribe()}),!0),this.get(F=>F.textureRef)}}return c.\u0275fac=function(t){return new(t||c)(n.LFG(l.gj),n.LFG(l.W7))},c.\u0275prov=n.Yz7({token:c,factory:c.\u0275fac}),c})(),Bt=(()=>{class c extends dt{constructor(){super(...arguments),this.setEnvironment=this.effect((0,l.oe)(()=>{const{map:t,background:a,scene:y}=this.get(),F=this.store.get(_=>_.scene);if(t){const _=Pt(y||F),v=_.background,B=_.environment;return"only"!==a&&(_.environment=t),a&&(_.background=t),()=>{"only"!==a&&(_.environment=B),a&&(_.background=v)}}}))}preInit(){super.preInit(),this.set(t=>{var a;return{background:null!==(a=t.background)&&void 0!==a&&a}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.setEnvironment(this.select(this.store.select(t=>t.scene),this.select(t=>t.background),this.select(t=>t.map),this.select(t=>t.scene).pipe((0,l.Xb)())))})})}}return c.\u0275fac=function(){let f;return function(a){return(f||(f=n.n5z(c)))(a||c)}}(),c.\u0275cmp=n.Xpm({type:c,selectors:[["ngt-soba-environment-map","map",""]],features:[n._Bn([{provide:dt,useExisting:c}]),n.qOj],attrs:T,ngContentSelectors:j,decls:1,vars:0,template:function(t,a){1&t&&(n.F$t(),n.Hsn(0))},encapsulation:2,changeDetection:0}),c})(),It=(()=>{class c extends dt{constructor(t,a,y,F,_){super(t,a,y,F),this.environmentResolver=_,this.setEnvironment=this.effect((0,l.oe)(({texture:v})=>{const B=this.store.get(xt=>xt.scene),{background:q,scene:yt}=this.get(),ft=Pt(yt||B),pt=ft.background,St=ft.environment;return"only"!==q&&(ft.environment=v),q&&(ft.background=v),()=>{"only"!==q&&(ft.environment=St),q&&(ft.background=pt)}}))}preInit(){super.preInit(),this.set(t=>{var a;return{background:null!==(a=t.background)&&void 0!==a&&a}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{const t=this.environmentResolver.use(a=>this.select(this.select(y=>y.files).pipe((0,m.O)(a.files)),this.select(y=>y.path).pipe((0,m.O)(a.path)),this.select(y=>y.preset).pipe((0,l.Xb)()),this.select(y=>y.extensions).pipe((0,l.Xb)()),(y,F,_,v)=>({files:y,path:F,preset:_,extensions:v})));this.setEnvironment(this.select(t.pipe((0,d.h)(a=>!!a)),this.select(a=>a.background),this.select(a=>a.scene).pipe((0,l.Xb)()),this.store.select(a=>a.scene),a=>({texture:a})))})})}}return c.\u0275fac=function(t){return new(t||c)(n.Y36(n.R0b),n.Y36(l.W7),n.Y36(l.cz,12),n.Y36(l.Aw,12),n.Y36(Ft))},c.\u0275cmp=n.Xpm({type:c,selectors:[["ngt-soba-environment-cube"]],features:[n._Bn([{provide:dt,useExisting:c},Ft]),n.qOj],ngContentSelectors:j,decls:1,vars:0,template:function(t,a){1&t&&(n.F$t(),n.Hsn(0))},encapsulation:2,changeDetection:0}),c})(),wt=(()=>{class c{constructor(t){this.templateRef=t}}return c.\u0275fac=function(t){return new(t||c)(n.Y36(n.Rgc))},c.\u0275dir=n.lG2({type:c,selectors:[["ng-template","ngt-soba-environment-content",""]]}),c})(),kt=(()=>{class c extends dt{constructor(){super(...arguments),this.virtualScene=new l.Rl((0,l.Pl)(new o.xsS,()=>this.store.get())),this.cubeCamera=new l.Rl,this.count=1,this.fbo$=this.select(t=>t.fbo),this.setEnvironment=this.effect((0,l.oe)(()=>{const{gl:t,scene:a}=this.store.get(),{frames:y,scene:F,background:_,fbo:v}=this.get();1===y&&this.cubeCamera.value.update(t,this.virtualScene.value);const B=Pt(F||a),q=B.background,yt=B.environment;return"only"!==_&&(B.environment=v.texture),_&&(B.background=v.texture),()=>{"only"!==_&&(B.environment=yt),_&&(B.background=q)}}))}preInit(){super.preInit(),this.set(t=>{var a,y,F,_,v;return{near:null!==(a=t.near)&&void 0!==a?a:1,far:null!==(y=t.far)&&void 0!==y?y:1e3,resolution:null!==(F=t.resolution)&&void 0!==F?F:256,frames:null!==(_=t.frames)&&void 0!==_?_:1,background:null!==(v=t.background)&&void 0!==v&&v}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.set(this.select(this.select(t=>t.resolution),t=>{const a=new o.oAp(t);return a.texture.type=o.cLu,{fbo:a}})),this.setEnvironment(this.select(this.select(),this.cubeCamera.pipe((0,d.h)(t=>!!t))))})})}onBeforeRender(){const{camera:t,frames:a}=this.get(),y=this.store.get(F=>F.gl);t&&(a===1/0||this.count<a)&&(t.update(y,this.virtualScene.value),this.count++)}}return c.\u0275fac=function(){let f;return function(a){return(f||(f=n.n5z(c)))(a||c)}}(),c.\u0275cmp=n.Xpm({type:c,selectors:[["ngt-soba-environment-portal"]],contentQueries:function(t,a,y){if(1&t&&n.Suo(y,wt,7),2&t){let F;n.iGM(F=n.CRH())&&(a.content=F.first)}},features:[n._Bn([{provide:dt,useExisting:c}]),n.qOj],decls:7,vars:7,consts:[[3,"ref"],[4,"ngTemplateOutlet"],[3,"ref","args","beforeRender",4,"ngIf"],[3,"ngtSobaEnvironmentPassThrough",4,"ngIf","ngIfElse"],["environmentMap",""],[3,"ref","args","beforeRender"],[3,"ngtSobaEnvironmentPassThrough"],[3,"ngtSobaEnvironmentPassThrough","map"]],template:function(t,a){if(1&t&&(n.TgZ(0,"ngt-portal",0),n.YNc(1,$,1,0,"ng-container",1),n.YNc(2,X,1,6,"ngt-cube-camera",2),n.ALo(3,"async"),n.YNc(4,rt,1,1,"ngt-soba-environment-cube",3),n.YNc(5,J,1,2,"ng-template",null,4,n.W1O),n.qZA()),2&t){const y=n.MAs(6);n.Q6J("ref",a.virtualScene),n.xp6(1),n.Q6J("ngTemplateOutlet",a.content.templateRef),n.xp6(1),n.Q6J("ngIf",n.lcZ(3,5,a.fbo$)),n.xp6(2),n.Q6J("ngIf",a.files||a.preset)("ngIfElse",y)}},directives:[mt.WS,I.tP,I.O5,ct.e,It,Tt,Bt],pipes:[I.Ov],encapsulation:2,changeDetection:0}),c})(),Lt=(()=>{class c extends dt{constructor(t,a,y,F,_){super(t,a,y,F),this.environmentResolver=_,this.materialRef=new l.Rl,this.vertexShader="\nvarying vec3 vWorldPosition;\n\nvoid main() {\n  vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n  vWorldPosition = worldPosition.xyz;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",this.uniforms={cubemap:{value:null},height:{value:15},radius:{value:60}},this.environmentGroundViewModel$=this.select(this.select(v=>v.texture),this.select(v=>v.scale),this.select(v=>v.fragment),(v,B,q)=>({texture:v,scale:B,fragment:q})),this.setDefines=this.effect((0,P.b)(()=>{var v,B;const{isCubeMap:q,texture:yt}=this.get(),pt=(null!==(B=q?null===(v=yt.image[0])||void 0===v?void 0:v.width:yt.image.width)&&void 0!==B?B:1024)/4,St=Math.floor(Math.log2(pt)),xt=Math.pow(2,St),Ot=3*Math.max(xt,112);this.set({defines:[q?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/Ot,"#define CUBEUV_TEXEL_HEIGHT "+1/(4*xt),`#define CUBEUV_MAX_MIP ${St}.0`,""]})})),this.setFragment=this.effect((0,P.b)(()=>{const v=this.get(B=>B.defines);this.set({fragment:v.join("\n")+"\n#define ENVMAP_TYPE_CUBE_UV\n\nvarying vec3 vWorldPosition;\n\nuniform float radius;\nuniform float height;\n\n#ifdef ENVMAP_TYPE_CUBE\n  uniform samplerCube cubemap;\n#else\n  uniform sampler2D cubemap;\n#endif\n\n// From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\nfloat diskIntersect( in vec3 ro, in vec3 rd, vec3 c, vec3 n, float r ) {\n    vec3  o = ro - c;\n    float t = -dot(n, o)/dot(rd,n);\n    vec3  q = o + rd * t;\n    return (dot(q, q) < r * r) ? t : 1e6;\n}\n\n// From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\nfloat sphereIntersect( in vec3 ro, in vec3 rd, in vec3 ce, float ra ) {\n    vec3 oc = ro - ce;\n    float b = dot( oc, rd );\n    float c = dot( oc, oc ) - ra*ra;\n    float h = b * b - c;\n    if(h < 0.0) -1.0;\n    h = sqrt( h );\n    return -b + h;\n}\n\nvec3 project() {\n  vec3 p = normalize(vWorldPosition);\n  vec3 camPos = cameraPosition;\n  camPos.y -= height;\n\n  float intersection = sphereIntersect(camPos, p, vec3(0.), radius);\n  if(intersection > 0.) {\n    vec3 h = vec3(0.0,-height,0.0);\n    float intersection2 = diskIntersect(camPos, p, h, vec3(0.0,-1.0,0.0), radius);\n    p = (camPos + min(intersection, intersection2) * p) / radius;\n  }\n  else {\n    p = vec3(0.0,1.0,0.0);\n  }\n  return p;\n}\n\n#include <common>\n#include <cube_uv_reflection_fragment>\n\nvoid main(){\n  vec3 projectedWorldPosition = project();\n\n  #ifdef ENVMAP_TYPE_CUBE\n    vec3 outcolor = textureCube(cubemap, projectedWorldPosition).rgb;\n  #else\n    vec3 direction = normalize(projectedWorldPosition);\n    vec2 uv = equirectUv(direction);\n    vec3 outcolor = texture2D(cubemap, uv).rgb;\n  #endif\n\n  gl_FragColor = vec4(outcolor, 1.0);\n\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n}"})})),this.setMaterialOptions=this.effect((0,P.b)(()=>{var v;const B=this.get(q=>q.ground);this.set({height:null==B?void 0:B.height,radius:null==B?void 0:B.radius,scale:null!==(v=null==B?void 0:B.scale)&&void 0!==v?v:1e3})})),this.setHeightUniform=this.effect((0,Q.z)((0,z.Q)(N.Z),(0,P.b)(()=>{const{height:v}=this.get();this.materialRef.value&&v&&(this.materialRef.value.uniforms.height.value=v)}))),this.setRadiusUniform=this.effect((0,Q.z)((0,z.Q)(N.Z),(0,P.b)(()=>{const{radius:v}=this.get();this.materialRef.value&&v&&(this.materialRef.value.uniforms.radius.value=v)}))),this.setCubeMapUniform=this.effect((0,Q.z)((0,z.Q)(N.Z),(0,P.b)(()=>{const{texture:v}=this.get();this.materialRef.value&&(this.materialRef.value.uniforms.cubemap.value=v)})))}ngOnInit(){super.ngOnInit(),this.onCanvasReady(this.store.ready$,()=>{const t=this.environmentResolver.use(a=>this.select(this.select(y=>y.files).pipe((0,m.O)(a.files)),this.select(y=>y.path).pipe((0,m.O)(a.path)),this.select(y=>y.preset).pipe((0,l.Xb)()),this.select(y=>y.extensions).pipe((0,l.Xb)()),(y,F,_,v)=>({files:y,path:F,preset:_,extensions:v})));this.set(this.select(this.select(a=>a.map).pipe((0,l.Xb)()),t.pipe((0,d.h)(a=>!!a)),(a,y)=>(a&&(y=a),{texture:y,isCubeMap:Gt(y)}))),this.setDefines(this.select(a=>a.texture).pipe((0,L.q)(1))),this.setFragment(this.select(a=>a.defines)),this.setMaterialOptions(this.select(a=>a.ground)),this.setHeightUniform(this.select(this.materialRef.pipe((0,d.h)(a=>!!a)),this.select(a=>a.height).pipe((0,l.Xb)()))),this.setRadiusUniform(this.select(this.materialRef.pipe((0,d.h)(a=>!!a)),this.select(a=>a.radius).pipe((0,l.Xb)()))),this.setCubeMapUniform(this.select(this.materialRef.pipe((0,d.h)(a=>!!a)),this.select(a=>a.texture)))})}}return c.\u0275fac=function(t){return new(t||c)(n.Y36(n.R0b),n.Y36(l.W7),n.Y36(l.cz,12),n.Y36(l.Aw,12),n.Y36(Ft))},c.\u0275cmp=n.Xpm({type:c,selectors:[["ngt-soba-environment-ground"]],features:[n._Bn([{provide:dt,useExisting:c},Ft]),n.qOj],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ngtSobaEnvironmentPassThrough","map"],[3,"scale"],[3,"args"],[3,"ref","side","vertexShader","fragmentShader","uniforms"]],template:function(t,a){1&t&&(n.YNc(0,E,6,12,"ng-container",0),n.ALo(1,"async")),2&t&&n.Q6J("ngIf",n.lcZ(1,1,a.environmentGroundViewModel$))},directives:[I.O5,Bt,Tt,bt.o,w.v,ot.y],pipes:[I.Ov,s.i],encapsulation:2,changeDetection:0}),c})(),Ut=(()=>{class c extends dt{}return c.\u0275fac=function(){let f;return function(a){return(f||(f=n.n5z(c)))(a||c)}}(),c.\u0275cmp=n.Xpm({type:c,selectors:[["ngt-soba-environment"]],contentQueries:function(t,a,y){if(1&t&&n.Suo(y,wt,5),2&t){let F;n.iGM(F=n.CRH())&&(a.content=F.first)}},features:[n._Bn([{provide:dt,useExisting:c}]),n.qOj],ngContentSelectors:j,decls:4,vars:2,consts:[[3,"ngtSobaEnvironmentPassThrough",4,"ngIf","ngIfElse"],["mapOrPortalOrCube",""],[3,"ngtSobaEnvironmentPassThrough"],[3,"ngtSobaEnvironmentPassThrough","map",4,"ngIf","ngIfElse"],["portalOrCube",""],[3,"ngtSobaEnvironmentPassThrough","map"],["cube",""],["ngt-soba-environment-content",""],[4,"ngTemplateOutlet"]],template:function(t,a){if(1&t&&(n.F$t(),n.YNc(0,g,1,1,"ngt-soba-environment-ground",0),n.YNc(1,Mt,3,2,"ng-template",null,1,n.W1O),n.Hsn(3)),2&t){const y=n.MAs(2);n.Q6J("ngIf",!!a.ground)("ngIfElse",y)}},directives:[I.O5,Lt,Tt,Bt,kt,wt,I.tP,It],encapsulation:2,changeDetection:0}),c})(),Ht=(()=>{class c{}return c.\u0275fac=function(t){return new(t||c)},c.\u0275mod=n.oAB({type:c}),c.\u0275inj=n.cJS({imports:[[l.yh,I.ez,st.UC,nt.M$,R.Jv,U.RQ,l.g8]]}),c})()},4994:(Nt,et,i)=>{i.d(et,{n:()=>l});const l={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"}},7426:(Nt,et,i)=>{i.d(et,{fH:()=>Q,vc:()=>z});var l=i(7540),st=i(4476),R=i(2310),U=i(2046),nt=i(1137);class I extends U.Kj0{constructor(){super(new U.DvJ(1,1,1),I.material)}}(0,nt.Z)(I,"SkyShader",{uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new U.Pa4},up:{value:new U.Pa4(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","void main() {","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( direction, vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","#include <tonemapping_fragment>","#include <encodings_fragment>","}"].join("\n")}),(0,nt.Z)(I,"material",new U.jyz({name:"SkyShader",fragmentShader:I.SkyShader.fragmentShader,vertexShader:I.SkyShader.vertexShader,uniforms:U.rDY.clone(I.SkyShader.uniforms),side:U._Li,depthWrite:!1}));var p=i(3193);const O=function(N){return{sky:N}};function S(N,L){if(1&N&&p.GkF(0,1),2&N){const o=p.oxw();p.Q6J("ngTemplateOutlet",o.content.templateRef)("ngTemplateOutletContext",p.VKq(2,O,o.instance))}}const m=["*"];function d(N,L,o=new U.Pa4){const W=Math.PI*(N-.5),tt=2*Math.PI*(L-.5);return o.x=Math.cos(tt),o.y=Math.sin(W),o.z=Math.sin(tt),o}let P=(()=>{class N{constructor(o){this.templateRef=o}static ngTemplateContextGuard(o,W){return!0}}return N.\u0275fac=function(o){return new(o||N)(p.Y36(p.Rgc))},N.\u0275dir=p.lG2({type:N,selectors:[["ng-template","ngt-soba-sky-content",""]]}),N})(),Q=(()=>{class N extends l.uT{constructor(){super(...arguments),this.setScale=this.effect((0,R.b)(()=>{const o=this.get(W=>W.distance);this.instance.value.scale.copy((new U.Pa4).setScalar(o))})),this.updateMaterialUniforms=this.effect((0,R.b)(()=>{const{mieCoefficient:o,mieDirectionalG:W,rayleigh:tt,sunPosition:n,turbidity:mt}=this.get(),ct=this.instance.value.material;ct.uniforms.mieCoefficient.value=o,ct.uniforms.mieDirectionalG.value=W,ct.uniforms.rayleigh.value=tt,ct.uniforms.sunPosition.value=n,ct.uniforms.turbidity.value=mt,(0,l.QF)(ct)}))}set distance(o){this.set({distance:(0,l.su)(o)})}set sunPosition(o){this.set({sunPosition:o})}set inclination(o){this.set({inclination:(0,l.su)(o)})}set azimuth(o){this.set({azimuth:(0,l.su)(o)})}set mieCoefficient(o){this.set({mieCoefficient:(0,l.su)(o)})}set mieDirectionalG(o){this.set({mieDirectionalG:(0,l.su)(o)})}set rayleigh(o){this.set({rayleigh:(0,l.su)(o)})}set turbidity(o){this.set({turbidity:(0,l.su)(o)})}preInit(){super.preInit(),this.set(o=>{var W,tt,n,mt,ct,bt,w,ot;const s=null!==(W=o.inclination)&&void 0!==W?W:.6,T=null!==(tt=o.azimuth)&&void 0!==tt?tt:.1;return{inclination:s,azimuth:T,distance:null!==(n=o.distance)&&void 0!==n?n:1e3,mieCoefficient:null!==(mt=o.mieCoefficient)&&void 0!==mt?mt:.005,mieDirectionalG:null!==(ct=o.mieDirectionalG)&&void 0!==ct?ct:.8,rayleigh:null!==(bt=o.rayleigh)&&void 0!==bt?bt:.5,turbidity:null!==(w=o.turbidity)&&void 0!==w?w:10,sunPosition:null!==(ot=o.sunPosition)&&void 0!==ot?ot:d(s,T)}})}postInit(){super.postInit(),this.setScale(this.select(o=>o.distance)),this.updateMaterialUniforms(this.select(this.select(o=>o.mieCoefficient),this.select(o=>o.mieDirectionalG),this.select(o=>o.rayleigh),this.select(o=>o.sunPosition),this.select(o=>o.turbidity)))}get meshType(){return I}}return N.\u0275fac=function(){let L;return function(W){return(L||(L=p.n5z(N)))(W||N)}}(),N.\u0275cmp=p.Xpm({type:N,selectors:[["ngt-soba-sky"]],contentQueries:function(o,W,tt){if(1&o&&p.Suo(tt,P,5),2&o){let n;p.iGM(n=p.CRH())&&(W.content=n.first)}},inputs:{distance:"distance",sunPosition:"sunPosition",inclination:"inclination",azimuth:"azimuth",mieCoefficient:"mieCoefficient",mieDirectionalG:"mieDirectionalG",rayleigh:"rayleigh",turbidity:"turbidity"},features:[p.qOj],ngContentSelectors:m,decls:2,vars:1,consts:[[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(o,W){1&o&&(p.F$t(),p.YNc(0,S,1,4,"ng-container",0),p.Hsn(1)),2&o&&p.Q6J("ngIf",W.content)},directives:[st.O5,st.tP],encapsulation:2,changeDetection:0}),N})(),z=(()=>{class N{}return N.\u0275fac=function(o){return new(o||N)},N.\u0275mod=p.oAB({type:N}),N.\u0275inj=p.cJS({imports:[[st.ez]]}),N})()},1658:(Nt,et,i)=>{i.d(et,{f4:()=>rt,sz:()=>X,YS:()=>J});var l=i(7540),st=i(221),R=i(2089),U=i(7322),nt=i(4476),I=i(6517);function p(b){return(0,I.h)((E,g)=>b<=g)}var O=i(4643),S=i(6822),m=i(4386),d=i(2310),P=i(1569),Q=i(1238),z=i(2046),N=i(8736),L=i(1785),o=i(3193),W=i(4552),tt=i(9049),n=i(132),mt=i(2164),ct=i(9035),bt=i(8607);const w=function(b){return{group:b}};function ot(b,E){if(1&b&&o.GkF(0,9),2&b){const g=o.oxw();o.Q6J("ngTemplateOutlet",g.content.templateRef)("ngTemplateOutletContext",o.VKq(2,w,g.innerGroup))}}function s(b,E){if(1&b&&o._UZ(0,"ngt-soba-contact-shadows",10),2&b){const g=o.oxw();o.Q6J("scale",2*g.radius)("far",g.radius/2)("blur",g.contactShadow.blur)("opacity",g.contactShadow.opacity)("position",g.contactShadow.position)}}function T(b,E){if(1&b&&o._UZ(0,"ngt-soba-environment",11),2&b){const g=o.oxw();o.Q6J("preset",g.environment)}}const j=function(b,E,g){return[b,E,g]},$=function(){return["shadow","bias"]},at={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};let X=(()=>{class b{constructor(g){this.templateRef=g}static ngTemplateContextGuard(g,x){return!0}}return b.\u0275fac=function(g){return new(g||b)(o.Y36(o.Rgc))},b.\u0275dir=o.lG2({type:b,selectors:[["ng-template","ngt-soba-stage-content",""]]}),b})(),rt=(()=>{class b extends l.Fq{constructor(){super(...arguments),this.setDimensions=this.effect((0,O.z)((0,S.Q)(m.z),(0,d.b)(()=>{const{innerGroup:g,outerGroup:x}=this.get();if(g.value&&x.value){x.value.position.set(0,0,0),x.value.updateWorldMatrix(!0,!0);const A=(new z.ZzF).setFromObject(g.value),K=new z.Pa4,ut=new z.aLr,ht=A.max.y-A.min.y,vt=A.max.x-A.min.x;A.getCenter(K),A.getBoundingSphere(ut),this.zone.run(()=>{this.set({radius:ut.radius,width:vt,height:ht})}),x.value.position.set(-K.x,ht/2-K.y,-K.z)}}))),this.updateControls=this.effect((0,d.b)(()=>{const{adjustCamera:g,width:x,height:A,radius:K}=this.get(),{camera:ut,controls:ht}=this.store.get();if(g){const vt=K/(A>x?1.5:2.5);ut.position.set(0,.5*K,2.5*K),ut.near=.1,ut.far=Math.max(5e3,4*K),ut.lookAt(0,vt,0),ht&&(ht.target.set(0,vt,0),ht.update())}}))}get shadows(){return this.get(g=>g.shadows)}set shadows(g){this.set({shadows:(0,l.Ig)(g)})}get adjustCamera(){return this.get(g=>g.adjustCamera)}set adjustCamera(g){this.set({adjustCamera:(0,l.Ig)(g)})}get environment(){return this.get(g=>g.environment)}set environment(g){this.set({environment:g})}get intensity(){return this.get(g=>g.intensity)}set intensity(g){this.set({intensity:(0,l.su)(g)})}get ambience(){return this.get(g=>g.ambience)}set ambience(g){this.set({ambience:(0,l.su)(g)})}get preset(){return this.get(g=>g.preset)}set preset(g){this.set({preset:g})}get shadowBias(){return this.get(g=>g.shadowBias)}set shadowBias(g){this.set({shadowBias:(0,l.su)(g)})}get contactShadow(){return this.get(g=>g.contactShadow)}set contactShadow(g){this.set({contactShadow:g})}get innerGroup(){return this.get(g=>g.innerGroup)}get outerGroup(){return this.get(g=>g.outerGroup)}get radius(){return this.get(g=>g.radius)}get width(){return this.get(g=>g.width)}get height(){return this.get(g=>g.height)}get config(){return at[this.get(g=>g.preset)]}preInit(){super.preInit(),this.set(g=>{var x,A,K,ut,ht,vt,Mt;return{innerGroup:new l.Rl,outerGroup:new l.Rl,radius:0,width:0,height:0,shadows:null===(x=g.shadows)||void 0===x||x,adjustCamera:null===(A=g.adjustCamera)||void 0===A||A,environment:null!==(K=g.environment)&&void 0!==K?K:"city",intensity:null!==(ut=g.intensity)&&void 0!==ut?ut:1,preset:null!==(ht=g.preset)&&void 0!==ht?ht:"rembrandt",shadowBias:null!==(vt=g.shadowBias)&&void 0!==vt?vt:0,contactShadow:null!==(Mt=g.contactShadow)&&void 0!==Mt?Mt:{blur:2,opacity:.5,position:[0,0,0]}}})}ngAfterContentInit(){this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.setDimensions(this.select(this.innerGroup.pipe((0,I.h)(g=>!!g)),this.outerGroup.pipe((0,I.h)(g=>!!g)),this.children.changes.pipe((0,P.w)(()=>(0,Q.a)(this.children.map(g=>g())))))),this.updateControls(this.select(this.store.select(g=>g.controls),this.select(g=>g.radius).pipe(p(1)),this.select(g=>g.height).pipe(p(1)),this.select(g=>g.width).pipe(p(1)),this.select(g=>g.adjustCamera)))})})}}return b.\u0275fac=function(){let E;return function(x){return(E||(E=o.n5z(b)))(x||b)}}(),b.\u0275cmp=o.Xpm({type:b,selectors:[["ngt-soba-stage"]],contentQueries:function(g,x,A){if(1&g&&(o.Suo(A,X,5),o.Suo(A,l.Dh,4)),2&g){let K;o.iGM(K=o.CRH())&&(x.content=K.first),o.iGM(K=o.CRH())&&(x.children=K)}},inputs:{shadows:"shadows",adjustCamera:"adjustCamera",environment:"environment",intensity:"intensity",ambience:"ambience",preset:"preset",shadowBias:"shadowBias",contactShadow:"contactShadow"},features:[o._Bn([(0,l.Hm)(b,E=>E.innerGroup)]),o.qOj],decls:10,vars:24,consts:[["skipParent","",3,"ngtObjectOutputs","ngtObjectInputs"],[3,"ref"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"scale","far","blur","opacity","position",4,"ngIf"],[3,"preset",4,"ngIf"],[3,"intensity"],["penumbra","1",3,"position","intensity","castShadow"],[3,"attach","value"],[3,"position","intensity"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"scale","far","blur","opacity","position"],[3,"preset"]],template:function(g,x){1&g&&(o.TgZ(0,"ngt-group",0)(1,"ngt-group",1)(2,"ngt-group",1),o.YNc(3,ot,1,4,"ng-container",2),o.qZA()(),o.YNc(4,s,1,5,"ngt-soba-contact-shadows",3),o.YNc(5,T,1,1,"ngt-soba-environment",4),o._UZ(6,"ngt-ambient-light",5),o.TgZ(7,"ngt-spot-light",6),o._UZ(8,"ngt-value",7),o.qZA(),o._UZ(9,"ngt-point-light",8),o.qZA()),2&g&&(o.Q6J("ngtObjectOutputs",x)("ngtObjectInputs",x),o.xp6(1),o.Q6J("ref",x.outerGroup),o.xp6(1),o.Q6J("ref",x.innerGroup),o.xp6(1),o.Q6J("ngIf",x.content),o.xp6(1),o.Q6J("ngIf",x.contactShadow),o.xp6(1),o.Q6J("ngIf",x.environment),o.xp6(1),o.Q6J("intensity",x.intensity/3),o.xp6(1),o.Q6J("position",o.kEZ(15,j,x.config.main[0]*x.radius,x.config.main[1]*x.radius,x.config.main[2]*x.radius))("intensity",2*x.intensity)("castShadow",x.shadows),o.xp6(1),o.Q6J("attach",o.DdM(19,$))("value",x.shadowBias),o.xp6(1),o.Q6J("position",o.kEZ(20,j,x.config.fill[0]*x.radius,x.config.fill[1]*x.radius,x.config.fill[2]*x.radius))("intensity",x.intensity))},directives:[W.U,tt.V,nt.O5,nt.tP,N.g,L.$5,n.w,mt.K,ct.m,bt.H],encapsulation:2,changeDetection:0}),b})(),J=(()=>{class b{}return b.\u0275fac=function(g){return new(g||b)},b.\u0275mod=o.oAB({type:b}),b.\u0275inj=o.cJS({imports:[[R.I,l.y2,nt.ez,N.h,L.wj,U.EQ,U.Hk,st.pk,U.GK]]}),b})()},7727:(Nt,et,i)=>{i.d(et,{Z:()=>p});var l=i(9622),st=i(8667);const R={schedule(S){let m=requestAnimationFrame,d=cancelAnimationFrame;const{delegate:P}=R;P&&(m=P.requestAnimationFrame,d=P.cancelAnimationFrame);const Q=m(z=>{d=void 0,S(z)});return new st.w0(()=>null==d?void 0:d(Q))},requestAnimationFrame(...S){const{delegate:m}=R;return((null==m?void 0:m.requestAnimationFrame)||requestAnimationFrame)(...S)},cancelAnimationFrame(...S){const{delegate:m}=R;return((null==m?void 0:m.cancelAnimationFrame)||cancelAnimationFrame)(...S)},delegate:void 0};var nt=i(8191);const p=new class I extends nt.v{flush(m){this._active=!0;const d=this._scheduled;this._scheduled=void 0;const{actions:P}=this;let Q;m=m||P.shift();do{if(Q=m.execute(m.state,m.delay))break}while((m=P[0])&&m.id===d&&P.shift());if(this._active=!1,Q){for(;(m=P[0])&&m.id===d&&P.shift();)m.unsubscribe();throw Q}}}(class U extends l.o{constructor(m,d){super(m,d),this.scheduler=m,this.work=d}requestAsyncId(m,d,P=0){return null!==P&&P>0?super.requestAsyncId(m,d,P):(m.actions.push(this),m._scheduled||(m._scheduled=R.requestAnimationFrame(()=>m.flush(void 0))))}recycleAsyncId(m,d,P=0){if(null!=P&&P>0||null==P&&this.delay>0)return super.recycleAsyncId(m,d,P);m.actions.some(Q=>Q.id===d)||(R.cancelAnimationFrame(d),m._scheduled=void 0)}})}}]);